@using FleetManagement.Shared.Enums
@model IEnumerable<FleetManagement.Application.Aircrafts.DTOs.AircraftDto>
@{
    // Count by Status
    var activeCount = Model.Count(a => a.Status == AircraftStatus.Active);
    var maintenanceCount = Model.Count(a => a.Status == AircraftStatus.InMaintenance);

    // Count by Based Station
    var jeddahCount = Model.Count(a => a.Specification.BasedStation?.Equals("JEDDAH", StringComparison.OrdinalIgnoreCase) == true);

    // Count by Manufacturer
    var boeingCount = Model.Count(a => a.Manufacturer == AircraftManufacturers.Boeing);
    var airbusCount = Model.Count(a => a.Manufacturer == AircraftManufacturers.Airbus);
}

@{
    Layout = "_AircraftsLayout";

    ViewData["Title"] = "Aircraft Fleet";
}



<div class="aircraft-container">

    <div id="aircraftStats" class="aircraft-stats">
       <partial name="_AircraftStatsPartial" model="Model" />


    </div>


    <div class="aircraft-header">
        <h1>
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
            </svg>
            Aircrafts
        </h1>
        
        <button onclick="openCreateModal()" class="btn btn-primary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Add New Aircraft
        </button>
    </div>
    <div id="aircraftList" class="aircraft-list-box">
        <div class="aircraft-filter">
            <form method="get" asp-action="Index" asp-controller="Aircrafts" class="filter-form">
                <div class="filter-row">
                    <input type="text" name="Registration" placeholder="Registration" value="@(Context.Request.Query["Registration"])" />

                    <select name="Status">
                        <option value="">All Status</option>
                        @foreach (AircraftStatus status in Enum.GetValues(typeof(AircraftStatus)))
                        {
                            <option value="@status" @(Context.Request.Query["Status"] == status.ToString() ? "selected" : "")>@status</option>
                        }
                    </select>

                    <input type="text" name="BasedStation" placeholder="Based Station" value="@(Context.Request.Query["BasedStation"])" />
                    <input type="text" name="Model" placeholder="Model" value="@(Context.Request.Query["Model"])" />
                    <input type="number" name="YearFrom" placeholder="Year From" value="@(Context.Request.Query["YearFrom"])" />
                    <input type="number" name="YearTo" placeholder="Year To" value="@(Context.Request.Query["YearTo"])" />


                    <button type="submit" class="btn btn-primary">Filter</button>
                </div>
            </form>
        </div>

        
        @if (Model != null && Model.Any())
        {
            <div id="aircraftList" class="aircraft-grid">
                @foreach (var aircraft in Model)
                {
                    <partial name="_AircraftCard" model="aircraft" />

                }
            </div>
        }
        else
        {
            <div id="aircraftList" class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                </svg>
                <h3>No Aircraft Found</h3>
                <p>Get started by adding your first aircraft to the fleet.</p>
                <button onclick="openCreateModal()" class="btn btn-primary btn-new-aircraft">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    Add First Aircraft
                </button>
            </div>
        }
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay-del" id="deleteModalOverlay">
        <div class="modal-content-del">
            <h3>Confirm Delete</h3>
            <p>Are you sure you want to delete aircraft <strong id="deleteAircraftReg"></strong>?</p>
            <div class="modal-actions" style="display:flex; justify-content: space-around; margin-top:1rem;">
                <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
                <button id="cancelDeleteBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal Container -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModalOnOverlay(event)">
        <div id="modalContent"></div>
    </div>



</div>



<script src="~/js/Aircrafts/aircraft-management.js" asp-append-version="true"></script>